---
import MainLayout from '~/layouts/MainLayout.astro';
import { Icon } from 'astro-icon/components';
import { Code } from 'astro-expressive-code/components';
import StepNavigation from '../_components/StepNavigation.astro';
import AuditReport from '../_components/AuditReport.astro';
import AuditVerdict from '../_components/AuditVerdict.astro';
import KpiTable, { type KpiRow } from '../_components/KpiTable.astro';
import ViolationsTable, { type ViolationRow } from '../_components/ViolationsTable.astro';
import MetricsTable from '../_components/MetricsTable.astro';
import InventoryTable from '../_components/InventoryTable.astro';
import RemediationTable, { type RemediationRow } from '../_components/RemediationTable.astro';
import SectionCopy from '../../_components/SectionCopy.astro';
import AmberStardust from '../../_components/landing-page/AmberStardust.astro';
import Insight from '~/components/Insight.astro';
import ModificationList from '../_components/ModificationList.astro';
import ModificationGroup from '../_components/ModificationGroup.astro';
import ModificationItem from '../_components/ModificationItem.astro';

const applicationServiceConfig = `@Configuration
public class ApplicationServiceConfig {

    @Bean
    public OrderUseCases orderUseCases(
            OrderRepository orderRepository,
            CustomerRepository customerRepository,
            ProductRepository productRepository,
            InventoryUseCases inventoryUseCases,
            NotificationSender notificationSender) {
        return new OrderApplicationService(
                orderRepository, customerRepository,
                productRepository, inventoryUseCases,
                notificationSender);
    }

    @Bean
    public CustomerUseCases customerUseCases(
            CustomerRepository customerRepository,
            NotificationSender notificationSender) {
        return new CustomerApplicationService(
                customerRepository, notificationSender);
    }

    @Bean
    public ProductUseCases productUseCases(
            ProductRepository productRepository) {
        return new ProductCatalogService(productRepository);
    }

    @Bean
    public ShippingUseCases shippingUseCases(
            OrderRepository orderRepository,
            ShippingRepository shippingRepository,
            InventoryUseCases inventoryUseCases) {
        return new ShippingApplicationService(
                orderRepository, shippingRepository, inventoryUseCases);
    }

    @Bean
    public ReviewUseCases reviewUseCases(
            ReviewRepository reviewRepository,
            ProductRepository productRepository) {
        return new ReviewApplicationService(
                reviewRepository, productRepository);
    }

    @Bean
    public InventoryUseCases inventoryUseCases(
            InventoryRepository inventoryRepository,
            NotificationSender notificationSender) {
        return new InventoryApplicationService(
                inventoryRepository, notificationSender);
    }

    @Bean
    public NotificationUseCases notificationUseCases(
            NotificationRepository notificationRepository,
            EmailSender emailSender) {
        return new NotificationApplicationService(
                notificationRepository, emailSender);
    }
}`;

const hexaglueConfig = `classification:
  exclude:
    - "com.acme.shop.infrastructure.**"
    - "com.acme.shop.exception.**"

plugins:
  io.hexaglue.plugin.jpa:
    entitySuffix: "JpaEntity"
    repositorySuffix: "JpaRepository"
    adapterSuffix: "RepositoryAdapter"
    generateRepositories: true
    generateAdapters: true
    generateEmbeddables: true
    enableAuditing: false

  io.hexaglue.plugin.livingdoc:
    outputFormat: "markdown"
    includeMetrics: true

  io.hexaglue.plugin.audit.ddd:
    failOnBlocker: false`;

const kpiRows: KpiRow[] = [
    { dimension: 'DDD Compliance', value: '95%', weight: '25%', contribution: '23.75', threshold: '≥ 90%', status: 'OK', delta: '-5' },
    { dimension: 'Hexagonal Architecture', value: '90%', weight: '25%', contribution: '22.5', threshold: '≥ 90%', status: 'OK', delta: '+55' },
    { dimension: 'Dependencies', value: '0%', weight: '20%', contribution: '0.0', threshold: '≥ 80%', status: 'CRITICAL', delta: '=' },
    { dimension: 'Coupling', value: '31%', weight: '15%', contribution: '4.65', threshold: '≥ 70%', status: 'CRITICAL', delta: '=' },
    { dimension: 'Cohesion', value: '63%', weight: '15%', contribution: '9.45', threshold: '≥ 80%', status: 'CRITICAL', delta: '-8' },
];

const violationRows: ViolationRow[] = [
    { constraint: 'hexagonal:application-purity', count: 0, severity: 'MAJOR', delta: '-7', observation: 'Annotations Spring supprimées des services applicatifs' },
    { constraint: 'hexagonal:port-coverage', count: 0, severity: 'MAJOR', delta: '-6', observation: 'Tous les ports couverts par des adaptateurs générés' },
    { constraint: 'hexagonal:layer-isolation', count: 2, severity: 'MAJOR', delta: '+2', observation: 'OrderApplicationService et ShippingApplicationService dépendent de InventoryUseCases (Unclassified)' },
    { constraint: 'ddd:aggregate-boundary', count: 1, severity: 'MAJOR', delta: '+1', observation: "OrderLine accessible directement hors de l'agrégat Order" },
];

const remediationRows: RemediationRow[] = [
    {
        constraint: 'hexagonal:layer-isolation',
        violations: 2,
        severity: 'MAJOR',
        manualEffort: 1,
        hexaglueEffort: 0,
        description: 'Dépendance à InventoryUseCases UNCLASSIFIED',
    },
    {
        constraint: 'ddd:aggregate-boundary',
        violations: 1,
        severity: 'MAJOR',
        manualEffort: 1,
        hexaglueEffort: 0,
        description: 'OrderLine exposé hors de l\'agrégat',
    },
];
---

<MainLayout
  title="Étape 5 - Génération automatique de l'infrastructure | Migration E-Commerce"
  description="Génération automatique de l'infrastructure avec HexaGlue : 29 fichiers générés (entités JPA, mappers, repositories). Score 60/100, 0 violation critique."
>
  <!-- Hero -->
  <section class="pt-24 pb-16 md:pt-32 md:pb-20 relative w-full max-w-4xl mx-auto px-4 sm:px-8">
    <AmberStardust height="h-64 md:h-80" />
    <div class="max-w-5xl mx-auto">
      <div class="mt-8 max-w-3xl">
        <span class="bg-clip-text text-transparent bg-orange-yellow-gradient font-semibold text-sm uppercase tracking-wider">
          Étape 5
        </span>
        <h1 class="mt-4 font-heading heading-bold text-4xl md:text-5xl lg:text-6xl text-white text-balance">
          Génération automatique de l'infrastructure
        </h1>
        <a
          href="https://github.com/hexaglue/case-study-ecommerce/tree/step/5-generated"
          target="_blank"
          rel="noopener noreferrer"
          class="mt-4 px-4 py-2 group inline-flex items-center justify-center gap-2 rounded-full border border-astro-dark-100/30 hover:border-astro-dark-100/60 text-base font-normal text-astro-gray-200 hover:text-astro-gray-100 bg-astro-dark-600/30 transition-all ease-in-out duration-500"
        >
          <Icon name="logos/github" class="size-5" aria-hidden="true" />
          <code class="text-sm text-amber-400">step/5-generated</code>
        </a>
        <ul class="mt-6 text-lg text-astro-gray-200 font-light max-w-2xl space-y-1 list-disc list-inside">
          <li>Activation des plugins HexaGlue (JPA, living-doc, audit).</li>
          <li>29 fichiers générés automatiquement.</li>
          <li>Services applicatifs purifiés en POJOs purs.</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Modifications effectuées -->
  <section class="py-16 md:py-20 relative w-full max-w-4xl mx-auto px-4 sm:px-8">
    <div class="max-w-5xl mx-auto">
      <SectionCopy
        label="Modifications"
        title="Modifications effectuées"
        gradient="bg-orange-yellow-gradient"
      >
        Les plugins HexaGlue sont activés pour générer automatiquement toute la couche de persistance.
        Les services applicatifs sont purifiés : les annotations Spring sont déplacées vers l'infrastructure.
      </SectionCopy>

      <ModificationList class="mt-10">
        <ModificationGroup layer="application">
          <ModificationItem action="purify" count={7} label="services applicatifs" details="suppression @Service, @Transactional → POJOs purs" />
        </ModificationGroup>
        <ModificationGroup layer="adapters">
          <ModificationItem action="create" label="ApplicationServiceConfig.java" details="7 méthodes @Bean pour l'injection de dépendances" />
        </ModificationGroup>
        <ModificationGroup layer="configuration">
          <ModificationItem action="configure" label="pom.xml" details="plugins jpa + living-doc + audit" />
          <ModificationItem action="configure" label="hexaglue.yaml" details="exclude: infrastructure.**, exception.**" />
        </ModificationGroup>
      </ModificationList>

      <Insight>
        <ul>
          <li><strong>Services applicatifs purifiés</strong> : les annotations <code>@Service</code> et <code>@Transactional</code> sont remplacées par des déclarations <code>@Bean</code> dans une classe de configuration Spring</li>
          <li><strong>Plugins activés</strong> : le plugin JPA génère les entités, mappers, repositories et adaptateurs à partir du modèle domaine pur</li>
        </ul>
        <p>Les services applicatifs deviennent des POJOs purs, sans aucune dépendance vers Spring. Le câblage est isolé dans l'infrastructure.</p>
      </Insight>
    </div>
  </section>

  <!-- Code généré automatiquement -->
  <section class="py-16 md:py-20 relative w-full max-w-4xl mx-auto px-4 sm:px-8">
    <div class="max-w-5xl mx-auto">
      <SectionCopy
        label="Génération"
        title="Code généré automatiquement"
        gradient="bg-orange-yellow-gradient"
      >
        Le plugin JPA d'HexaGlue analyse le modèle domaine pur et génère toute la couche de persistance à la compilation. Aucun de ces fichiers n'est écrit à la main.
      </SectionCopy>

      <div class="mt-10 bg-astro-dark-800/40 border border-astro-dark-100/15 rounded-2xl p-8">
        <div class="grid grid-cols-1 gap-6">
          <div>
            <div class="flex items-center justify-between mb-2">
              <h3 class="text-lg font-semibold text-astro-brand-purple">Entités JPA</h3>
              <span class="px-3 py-1 bg-astro-brand-purple/20 text-astro-brand-purple rounded-full text-sm font-mono">8 fichiers</span>
            </div>
            <p class="text-sm text-astro-gray-300 mb-2">CustomerJpaEntity, OrderJpaEntity, OrderLineJpaEntity, ProductJpaEntity, ReviewJpaEntity, ShippingJpaEntity, InventoryJpaEntity, NotificationJpaEntity</p>
          </div>

          <div class="border-t border-astro-dark-100/15 pt-6">
            <div class="flex items-center justify-between mb-2">
              <h3 class="text-lg font-semibold text-astro-brand-purple">Embeddables</h3>
              <span class="px-3 py-1 bg-astro-brand-purple/20 text-astro-brand-purple rounded-full text-sm font-mono">2 fichiers</span>
            </div>
            <p class="text-sm text-astro-gray-300 mb-2">MoneyEmbeddable, AddressEmbeddable</p>
          </div>

          <div class="border-t border-astro-dark-100/15 pt-6">
            <div class="flex items-center justify-between mb-2">
              <h3 class="text-lg font-semibold text-astro-brand-purple">Spring Data Repositories</h3>
              <span class="px-3 py-1 bg-astro-brand-purple/20 text-astro-brand-purple rounded-full text-sm font-mono">6 fichiers</span>
            </div>
            <p class="text-sm text-astro-gray-300 mb-2">CustomerJpaRepository, OrderJpaRepository, ProductJpaRepository, ReviewJpaRepository, ShippingJpaRepository, InventoryJpaRepository</p>
          </div>

          <div class="border-t border-astro-dark-100/15 pt-6">
            <div class="flex items-center justify-between mb-2">
              <h3 class="text-lg font-semibold text-astro-brand-purple">MapStruct Mappers</h3>
              <span class="px-3 py-1 bg-astro-brand-purple/20 text-astro-brand-purple rounded-full text-sm font-mono">12 fichiers</span>
            </div>
            <p class="text-sm text-astro-gray-300 mb-2">6 interfaces + 6 implementations (CustomerMapper, OrderMapper, ProductMapper, ReviewMapper, ShippingMapper, InventoryMapper)</p>
          </div>

          <div class="border-t border-astro-dark-100/15 pt-6">
            <div class="flex items-center justify-between mb-2">
              <h3 class="text-lg font-semibold text-astro-brand-purple">Port Adapters</h3>
              <span class="px-3 py-1 bg-astro-brand-purple/20 text-astro-brand-purple rounded-full text-sm font-mono">7 fichiers</span>
            </div>
            <p class="text-sm text-astro-gray-300 mb-2">CustomerRepositoryAdapter, OrderRepositoryAdapter, ProductRepositoryAdapter, ReviewRepositoryAdapter, ShippingRepositoryAdapter, InventoryRepositoryAdapter, NotificationRepositoryAdapter</p>
          </div>

          <div class="border-t border-astro-dark-100/15 pt-6">
            <div class="flex items-center justify-between">
              <span class="text-xl font-bold text-astro-brand-teal">Total</span>
              <span class="px-4 py-2 bg-astro-brand-teal/20 text-astro-brand-teal rounded-full text-lg font-mono font-bold">29 fichiers</span>
            </div>
          </div>
        </div>
      </div>

      <Insight>
        <ul>
          <li><strong>29 fichiers générés</strong> : entités JPA, embeddables, repositories Spring Data, mappers MapStruct et adaptateurs de ports</li>
          <li><strong>0 ligne manuelle</strong> pour la persistance : tout est dérivé automatiquement du modèle domaine pur</li>
          <li><strong>Synchronisation garantie</strong> : si le domaine change, la couche de persistance est régénérée à la compilation suivante</li>
        </ul>
      </Insight>
    </div>
  </section>

  <!-- Exemples de code -->
  <section class="py-16 md:py-20 relative w-full max-w-4xl mx-auto px-4 sm:px-8">
    <div class="max-w-5xl mx-auto">
      <SectionCopy
        label="Code"
        title="Exemples de code"
        gradient="bg-orange-yellow-gradient"
      >
        Configuration Spring <code>@Bean</code> et fichier <code>hexaglue.yaml</code> pour activer la génération.
      </SectionCopy>

      <div class="mt-10 space-y-6">
        <div>
          <Code code={applicationServiceConfig} lang="java" title="ApplicationServiceConfig.java" />
        </div>

        <div>
          <Code code={hexaglueConfig} lang="yaml" title="hexaglue.yaml" />
        </div>
      </div>

      <Insight>
        <ul>
          <li><strong>ApplicationServiceConfig</strong> : chaque service applicatif est déclaré comme <code>@Bean</code>, avec ses dépendances injectées via les ports</li>
          <li><strong>hexaglue.yaml</strong> : configure les suffixes de nommage (<code>JpaEntity</code>, <code>JpaRepository</code>, <code>RepositoryAdapter</code>) et les options de génération</li>
          <li>Le câblage Spring est entièrement isolé dans la couche infrastructure</li>
        </ul>
      </Insight>
    </div>
  </section>

  <AuditReport description="Résultat après activation de la génération et purification des services.">

  <!-- Verdict de l'audit -->
  <section class="py-16 md:py-20 relative w-full max-w-4xl mx-auto px-4 sm:px-8">
    <div class="max-w-5xl mx-auto">
      <SectionCopy
        label="Verdict"
        title="Verdict de l'audit"
        gradient="bg-orange-yellow-gradient"
      >
        Le score franchit la barre des 60 points et atteint le grade D. La génération automatique et la purification des services résolvent 10 violations d'un coup.
      </SectionCopy>

      <div class="mt-10">
        <AuditVerdict
          score={60}
          grade="D"
          status="PASSED_WITH_WARNINGS"
          violations={{ critical: 0, major: 3 }}
          delta={{ score: 11, violations: -10 }}
        />
      </div>

      <Insight>
        <p>Le score progresse de 11 points grâce à deux actions combinées : la purification des services applicatifs et la génération automatique des adaptateurs. Les 3 violations Major restantes relèvent de choix de conception, pas de défauts structurels : elles sont détaillées dans les sections suivantes.</p>
      </Insight>
    </div>
  </section>

  <!-- Indicateurs de qualité -->
  <section class="py-16 md:py-20 relative w-full max-w-4xl mx-auto px-4 sm:px-8">
    <div class="max-w-5xl mx-auto">
      <SectionCopy
        label="Score"
        title="Décomposition du score"
        gradient="bg-orange-yellow-gradient"
      >
        Le score passe de 49 à 60/100. La dimension Hexagonal Architecture bondit grâce aux adaptateurs générés et aux services purifiés.
      </SectionCopy>

      <div class="mt-10">
        <KpiTable rows={kpiRows} total="60.35" />
      </div>

      <Insight>
        <ul>
          <li><strong>Hexagonal Architecture</strong> bondit à 90% (+55) : les adaptateurs générés couvrent tous les ports, et les services applicatifs ne portent plus d'annotations Spring</li>
          <li><strong>DDD Compliance</strong> recule légèrement à 95% (-5) : une violation <code>aggregate-boundary</code> a été détectée</li>
          <li><strong>Cohesion</strong> diminue à 63% (-8) : l'ajout de la classe <code>ApplicationServiceConfig</code> dans l'infrastructure modifie le ratio</li>
        </ul>
      </Insight>
    </div>
  </section>

  <!-- Violations détectées -->
  <section class="py-16 md:py-20 relative w-full max-w-4xl mx-auto px-4 sm:px-8">
    <div class="max-w-5xl mx-auto">
      <SectionCopy
        label="Violations"
        title="Violations détectées"
        gradient="bg-orange-yellow-gradient"
      >
        Les 13 violations Major de l'étape précédente sont résolues. Trois nouvelles violations apparaissent, liées à des points de conception plus fins.
      </SectionCopy>

      <div class="mt-10">
        <ViolationsTable rows={violationRows} />
      </div>

      <Insight>
        <ul>
          <li><strong>application-purity</strong> (-7) et <strong>port-coverage</strong> (-6) : entièrement résolues par la purification des services et la génération des adaptateurs</li>
          <li><strong>layer-isolation</strong> (+2) : deux services applicatifs dépendent de <code>InventoryUseCases</code>, classifié Unclassified car HexaGlue n'a pas pu déterminer son rôle architectural. L'annoter comme Application Service résoudra ces violations</li>
          <li><strong>aggregate-boundary</strong> (+1) : <code>OrderLine</code> est accessible directement depuis l'extérieur de l'agrégat <code>Order</code></li>
        </ul>
      </Insight>
    </div>
  </section>

  <!-- Couverture des ports -->
  <section class="py-16 md:py-20 relative w-full max-w-4xl mx-auto px-4 sm:px-8">
    <div class="max-w-5xl mx-auto">
      <SectionCopy
        label="Ports"
        title="Couverture des ports"
        gradient="bg-orange-yellow-gradient"
      >
        La couverture des ports mesure la proportion de ports (interfaces) qui ont une implémentation concrète (adaptateur).
        C'est un indicateur clé de la complétude de l'architecture hexagonale.
      </SectionCopy>

      <div class="mt-10 bg-astro-dark-800/40 border border-astro-dark-100/15 rounded-2xl p-6">
        <div class="flex items-center justify-between">
          <span class="text-lg font-semibold">Ports couverts</span>
          <span class="px-4 py-2 bg-green-500/20 text-green-400 rounded-full text-sm font-mono font-bold">14/14 (100%)</span>
        </div>
      </div>

      <Insight>
        <ul>
          <li><strong>6 repositories générés</strong> par HexaGlue : les driven ports de type REPOSITORY sont couverts automatiquement</li>
          <li><strong>6 contrôleurs REST</strong> écrits manuellement : chaque driving port est exposé via un contrôleur Spring. Un futur plugin REST de HexaGlue pourra également les générer</li>
          <li><strong>2 gateways</strong> écrits manuellement : les adaptateurs vers les services externes (paiement, notifications)</li>
        </ul>
      </Insight>
    </div>
  </section>

  <!-- Métriques détaillées -->
  <section class="py-16 md:py-20 relative w-full max-w-4xl mx-auto px-4 sm:px-8">
    <div class="max-w-5xl mx-auto">
      <SectionCopy
        label="Qualité"
        title="Métriques de qualité"
        gradient="bg-orange-yellow-gradient"
      >
        Les métriques de qualité mesurent l'adhérence du code aux principes DDD et hexagonaux.<br>
        Après la génération automatique, le tableau montre l'impact sur chaque indicateur.
      </SectionCopy>

      <div class="mt-10">
        <MetricsTable
          rows={[
            {
              metric: 'Domain purity',
              value: '100%',
              threshold: 'min 100%',
              status: 'OK',
              delta: '='
            },
            {
              metric: 'Aggregate boundary',
              value: '0%',
              threshold: 'min 80%',
              status: 'CRITICAL',
              delta: '-100'
            },
            {
              metric: 'Repository coverage',
              value: '100%',
              threshold: 'min 100%',
              status: 'OK',
              delta: '='
            },
            {
              metric: 'Code boilerplate',
              value: '80.20%',
              threshold: 'max 50%',
              status: 'CRITICAL',
              delta: '='
            },
            {
              metric: 'Code complexity',
              value: '1.12',
              threshold: 'max 10',
              status: 'OK',
              delta: '='
            }
          ]}
        />
      </div>

      <Insight>
        <ul>
          <li><strong><code>domain.purity</code> maintenue à 100%</strong> : le code généré ne pollue pas le domaine, il reste dans la couche infrastructure</li>
          <li><strong><code>aggregate.boundary</code> tombe à 0%</strong> : <code>OrderLine</code> est accessible directement hors de l'agrégat <code>Order</code>, ce qui casse l'encapsulation DDD</li>
          <li><strong><code>aggregate.repository.coverage</code> à 100%</strong> : chaque agrégat dispose désormais d'un repository généré automatiquement</li>
          <li><strong><code>code.boilerplate.ratio</code> reste élevé</strong> (80%) : le code généré (entités JPA, mappers) est comptabilisé comme boilerplate technique</li>
        </ul>
      </Insight>
    </div>
  </section>

  <!-- Plan de remédiation -->
  <section class="py-16 md:py-20 relative w-full max-w-4xl mx-auto px-4 sm:px-8">
    <div class="max-w-5xl mx-auto">
      <SectionCopy
        label="Remédiation"
        title="Coût de mise en conformité"
        gradient="bg-orange-yellow-gradient"
      >
        Le plan de remédiation estime l'effort restant pour atteindre la conformité architecturale.<br>
        Il distingue ce qui peut être automatisé par HexaGlue de ce qui nécessite une intervention manuelle.
      </SectionCopy>

      <div class="mt-10">
        <RemediationTable rows={remediationRows} />
      </div>

      <Insight>
        <p>Il ne reste que <strong>2 jours d'effort</strong>, contre 25 à l'étape précédente :</p>
        <ul>
          <li><strong>Classification</strong> : annoter <code>InventoryUseCases</code> comme Application Service pour résoudre les violations <code>layer-isolation</code></li>
          <li><strong>Encapsulation</strong> : rendre <code>OrderLine</code> accessible uniquement via l'agrégat <code>Order</code> pour restaurer <code>aggregate.boundary</code></li>
        </ul>
        <p>Ces deux corrections sont manuelles : elles relèvent de décisions de conception, pas de génération de code.</p>
        <p>L'infrastructure JPA (18 jours à l'étape précédente) n'apparaît plus : le code généré par HexaGlue fait désormais partie intégrante du projet et lui appartient. Il n'y a plus rien à quantifier, c'est acquis.</p>
      </Insight>
    </div>
  </section>

  </AuditReport>

  <!-- Bilan -->
  <section class="py-16 md:py-20 relative w-full max-w-4xl mx-auto px-4 sm:px-8">
    <div class="max-w-5xl mx-auto">
      <SectionCopy
        label="Bilan"
        title="Ce que révèle cette étape"
        gradient="bg-orange-yellow-gradient"
      >
        Cette étape marque un tournant : HexaGlue passe de l'analyse à la génération.<br>
        Le rapport montre l'impact combiné de la purification des services et de la génération automatique.
      </SectionCopy>

      <Insight class="mt-10">
        <p>HexaGlue démontre ici sa double capacité : analyser <strong>et</strong> construire.</p>
        <ul>
          <li><strong>Score 60/100 (+11)</strong> : la purification des services applicatifs et la génération de l'infrastructure font passer le grade de F à D</li>
          <li><strong>29 fichiers générés, 0 ligne manuelle</strong> : toute la couche de persistance (entités JPA, repositories, mappers, embeddables) est produite au compile-time</li>
          <li><strong>100% de couverture des ports</strong> : chaque port, driving ou driven, dispose d'un adaptateur fonctionnel</li>
          <li><strong>2 corrections restantes</strong> : classifier <code>InventoryUseCases</code> et encapsuler <code>OrderLine</code> dans son agrégat</li>
        </ul>
      </Insight>
    </div>
  </section>

  <!-- Transition -->
  <section class="relative w-full max-w-4xl mx-auto px-4 sm:px-8">
    <div class="max-w-5xl mx-auto">
      <div class="bg-amber-500/5 border border-amber-500/20 rounded-xl p-6">
        <p class="text-lg text-astro-gray-200">
          L'étape suivante résout ces derniers points pour atteindre la conformité complète.
        </p>
      </div>
    </div>
  </section>

  <!-- Navigation -->
  <section class="py-16 relative">
    <div class="w-full max-w-4xl mx-auto px-4 sm:px-8">
      <div class="max-w-5xl mx-auto">
        <StepNavigation
          prev={{ href: '/case-studies/ecommerce-migration/step-4-pure-domain/', label: 'Étape 4 - Purification du domaine' }}
          next={{ href: '/case-studies/ecommerce-migration/step-6-functional/', label: 'Étape 6 - Architecture hexagonale opérationnelle' }}
        />
      </div>
    </div>
    <div
      class="absolute inset-x-0 bottom-0 h-[50vw] translate-y-[60%] bg-orange-yellow-gradient opacity-50 mask-radial-gradient pointer-events-none"
    ></div>
  </section>
</MainLayout>
