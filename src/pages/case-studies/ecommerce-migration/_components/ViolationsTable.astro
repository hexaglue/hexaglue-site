---
import { Icon } from 'astro-icon/components';

export interface ViolationRow {
	constraint: string;
	count: number;
	severity: 'CRITICAL' | 'MAJOR';
	delta?: string;
	observation?: string;
}

interface Props {
	rows: ViolationRow[];
}

const { rows } = Astro.props;
---

<div class="overflow-x-auto">
	<table class="w-full text-sm">
		<thead>
			<tr class="border-b border-astro-dark-100/15 text-astro-gray-300 text-left">
				<th class="py-3 pr-4 font-medium">Contrainte</th>
				<th class="py-3 px-3 font-medium text-right">Nombre</th>
				<th class="py-3 px-3 font-medium text-center">Sévérité</th>
				{rows.some(r => r.delta) && <th class="py-3 px-3 font-medium text-right">Delta</th>}
				{rows.some(r => r.observation) && <th class="py-3 pl-3 font-medium hidden md:table-cell">Observation</th>}
			</tr>
		</thead>
		<tbody>
			{rows.map((row) => (
				<tr class="border-b border-astro-dark-100/10">
					<td class="py-3 pr-4 text-white font-medium">{row.constraint}</td>
					<td class="py-3 px-3 text-right text-white font-medium">{row.count}</td>
					<td class="py-3 px-3 text-center">
						<span class={`inline-flex items-center gap-1 text-xs font-medium px-2 py-0.5 rounded-full ${row.severity === 'CRITICAL' ? 'bg-red-400/10 text-red-400' : 'bg-yellow-400/10 text-yellow-400'}`}>
							{row.severity}
						</span>
					</td>
					{rows.some(r => r.delta) && (
						<td class={`py-3 px-3 text-right ${row.delta?.startsWith('+') ? 'text-red-400' : row.delta?.startsWith('-') ? 'text-astro-green' : 'text-astro-gray-300'}`}>
							{row.delta || '='}
						</td>
					)}
					{rows.some(r => r.observation) && (
						<td class="py-3 pl-3 text-astro-gray-200 text-xs hidden md:table-cell">{row.observation}</td>
					)}
				</tr>
			))}
		</tbody>
	</table>
</div>
