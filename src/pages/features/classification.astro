---
import { Icon } from 'astro-icon/components';
import { Code } from 'astro-expressive-code/components';
import MainLayout from '~/layouts/MainLayout.astro';
import SectionCopy from '../_components/SectionCopy.astro';
import Link from '../_components/Link.astro';
import IntroPoint from '../_components/IntroPoint.astro';
import GemIcon from '~/components/GemIcon.astro';
import Insight from '~/components/Insight.astro';
import GreenishStardust from '../_components/landing-page/GreenishStardust.astro';

const yamlConfig = `classification:
  # Exclure les classes utilitaires et de configuration
  exclude:
    - "com.acme.shop.config.*"
    - "com.acme.shop.util.*"

  # Surcharger une classification ambiguë
  explicit:
    com.acme.shop.domain.TaskService: DOMAIN_SERVICE
    com.acme.shop.domain.pricing.PricingEngine: DOMAIN_SERVICE`;
---

<MainLayout
	title="Classification Automatique"
	description="HexaGlue lit votre code Java et attribue un rôle architectural à chaque classe : agrégat, entité, value object, port, service. Sans annotation, sans configuration obligatoire."
	schema={{
		"@type": "TechArticle",
		proficiencyLevel: "Beginner",
		about: [
			{ "@type": "Thing", name: "Classification architecturale" },
			{ "@type": "Thing", name: "Domain-Driven Design" },
		],
	}}
>
	<!-- Hero Section -->
	<section class="pt-24 pb-16 md:pt-32 md:pb-20 relative w-full max-w-screen-xl mx-auto px-4 sm:px-8">
		<GreenishStardust height="h-64 md:h-80" />

		<div class="text-center max-w-3xl mx-auto">
			<span class="bg-clip-text text-transparent bg-blue-green-gradient font-semibold text-sm uppercase tracking-wider">
				Classification
			</span>

			<h1 class="mt-4 font-heading heading-bold text-4xl md:text-5xl lg:text-6xl text-white text-balance">
				Classification automatique du domaine.<br/>
				<span class="bg-clip-text text-transparent bg-blue-green-gradient">Du code source au modèle architectural.</span>
			</h1>

			<p class="mt-6 text-lg text-astro-gray-200 font-light max-w-2xl mx-auto text-balance">
				HexaGlue lit votre code Java et attribue un rôle architectural à chaque classe : agrégat, entité, value object, port, service. Sans annotation, sans configuration obligatoire.
			</p>
		</div>
	</section>

	<!-- Section 1 : Ce que HexaGlue classifie -->
	<section class="py-16 md:py-20 relative w-full max-w-screen-xl mx-auto px-4 sm:px-8">
		<SectionCopy
			label="Rôles détectés"
			title="10 rôles architecturaux identifiés automatiquement"
		>
			HexaGlue analyse la structure de vos classes Java et leur attribue un rôle architectural. Voici les rôles détectés, regroupés par couche.
		</SectionCopy>

		<div class="table-panel mt-10">
			<div class="table-panel-content max-w-4xl mx-auto overflow-x-auto">
				<table class="w-full text-sm text-left">
					<thead>
						<tr class="border-b border-astro-dark-100/20">
							<th class="py-3 pr-4 text-astro-gray-300 font-medium">Couche</th>
							<th class="py-3 pr-4 text-astro-gray-300 font-medium">Rôle</th>
							<th class="py-3 text-astro-gray-300 font-medium">Convention de détection</th>
						</tr>
					</thead>
					<tbody class="text-astro-gray-200">
						<tr class="border-b border-astro-dark-100/10">
							<td class="py-3 pr-4 font-medium text-white whitespace-nowrap">Domaine</td>
							<td class="py-3 pr-4 whitespace-nowrap">Aggregate Root</td>
							<td class="py-3">Classe avec un champ d'identité typé (ex: <code>OrderId</code>)</td>
						</tr>
						<tr class="border-b border-astro-dark-100/10">
							<td class="py-3 pr-4 font-medium text-white whitespace-nowrap">Domaine</td>
							<td class="py-3 pr-4 whitespace-nowrap">Entity</td>
							<td class="py-3">Classe membre d'un agrégat, sans identité propre</td>
						</tr>
						<tr class="border-b border-astro-dark-100/10">
							<td class="py-3 pr-4 font-medium text-white whitespace-nowrap">Domaine</td>
							<td class="py-3 pr-4 whitespace-nowrap">Value Object</td>
							<td class="py-3">Record immuable, comportement sans identité</td>
						</tr>
						<tr class="border-b border-astro-dark-100/10">
							<td class="py-3 pr-4 font-medium text-white whitespace-nowrap">Domaine</td>
							<td class="py-3 pr-4 whitespace-nowrap">Identifier</td>
							<td class="py-3">Record wrappant une valeur primitive (ex: <code>OrderId(Long value)</code>)</td>
						</tr>
						<tr class="border-b border-astro-dark-100/10">
							<td class="py-3 pr-4 font-medium text-white whitespace-nowrap">Domaine</td>
							<td class="py-3 pr-4 whitespace-nowrap">Domain Event</td>
							<td class="py-3">Record avec suffixe <code>Event</code> ou interface marqueur</td>
						</tr>
						<tr class="border-b border-astro-dark-100/10">
							<td class="py-3 pr-4 font-medium text-white whitespace-nowrap">Domaine</td>
							<td class="py-3 pr-4 whitespace-nowrap">Domain Service</td>
							<td class="py-3">Classe stateless dans le domaine, logique transverse</td>
						</tr>
						<tr class="border-b border-astro-dark-100/10">
							<td class="py-3 pr-4 font-medium text-white whitespace-nowrap">Ports</td>
							<td class="py-3 pr-4 whitespace-nowrap">Driving Port</td>
							<td class="py-3">Interface dans un package <code>ports/in/</code> ou <code>api/</code></td>
						</tr>
						<tr class="border-b border-astro-dark-100/10">
							<td class="py-3 pr-4 font-medium text-white whitespace-nowrap">Ports</td>
							<td class="py-3 pr-4 whitespace-nowrap">Driven Port</td>
							<td class="py-3">Interface dans un package <code>ports/out/</code> ou <code>spi/</code></td>
						</tr>
						<tr class="border-b border-astro-dark-100/10">
							<td class="py-3 pr-4 font-medium text-white whitespace-nowrap">Application</td>
							<td class="py-3 pr-4 whitespace-nowrap">Application Service</td>
							<td class="py-3">Classe implémentant un driving port</td>
						</tr>
						<tr>
							<td class="py-3 pr-4 font-medium text-white whitespace-nowrap">Application</td>
							<td class="py-3 pr-4 whitespace-nowrap">Command/Query Handler</td>
							<td class="py-3">Classe traitant une commande ou requête spécifique</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<div class="max-w-4xl mx-auto">
			<Insight variant="amber">
				<p>Chaque classification est traçable : HexaGlue enregistre la règle qui a déclenché la décision et le niveau de confiance. Vous pouvez inspecter chaque choix dans le rapport d'audit ou la living documentation.</p>
			</Insight>
		</div>
	</section>

	<!-- Section 2 : Comment ça fonctionne -->
	<section class="py-16 md:py-20 relative w-full max-w-screen-xl mx-auto px-4 sm:px-8">
		<SectionCopy
			label="Mécanisme"
			title="Trois niveaux de détection"
		>
			HexaGlue combine trois stratégies de classification, du plus automatique au plus explicite.
		</SectionCopy>

		<div class="mt-10 grid grid-cols-1 gap-8 md:grid-cols-2 md:gap-12 lg:grid-cols-3">
			<IntroPoint tint="green" title="Conventions de nommage et de packages">
				<GemIcon slot="icon" icon="ri/stack-line" gradient="blue-green" />
				<Fragment slot="description">
					La position d'une classe dans l'arborescence des packages et ses suffixes orientent la classification. Une interface dans <code>ports/out/</code> est un driven port. Un record nommé <code>OrderId</code> est un identifiant.
				</Fragment>
			</IntroPoint>

			<IntroPoint tint="green" title="Heuristiques structurelles">
				<GemIcon slot="icon" icon="ri/search-eye-line" gradient="red-pink" />
				<Fragment slot="description">
					La structure interne de la classe affine la détection. Une classe avec un champ d'identité typé est un agrégat. Un record immuable sans identité est un value object. Une interface avec des méthodes <code>save</code>/<code>findById</code> est un repository.
				</Fragment>
			</IntroPoint>

			<IntroPoint tint="green" title="Configuration explicite">
				<GemIcon slot="icon" icon="ri/settings-3-line" gradient="orange-yellow" />
				<Fragment slot="description">
					Quand les conventions ne suffisent pas, deux options : les annotations jMolecules directement dans le code, ou la surcharge dans <code>hexaglue.yaml</code> pour les réfractaires aux modèles enrichis (voir ci-dessous).
				</Fragment>
			</IntroPoint>
		</div>

		<div class="mt-10 max-w-4xl mx-auto">
			<Code code={yamlConfig} lang="yaml" title="hexaglue.yaml" />
		</div>
	</section>

	<!-- Section : Domaine riche vs anémique -->
	<section class="py-16 md:py-20 relative w-full max-w-screen-xl mx-auto px-4 sm:px-8">
		<SectionCopy
			label="Domaine riche vs anémique"
			title="Quand le domaine est mis en défaut"
			gradient="bg-blue-green-gradient"
		>
			Martin Fowler décrit le <a href="https://martinfowler.com/bliki/AnemicDomainModel.html" target="_blank" rel="noopener noreferrer">modèle de domaine anémique<Icon name="ri/external-link-line" class="inline size-3.5 ml-0.5" aria-hidden="true" /></a> comme un anti-pattern
			où les objets métier ne contiennent que des données, sans comportement.
			La logique métier est déportée dans des services, et les classes se ressemblent toutes : getters, setters, types primitifs.<br>
			<br>
			HexaGlue s'adapte aux deux situations :
			<ul>
				<li><strong>Domaine riche</strong> : les conventions et heuristiques suffisent, aucune annotation nécessaire</li>
				<li><strong>Domaine anémique</strong> : les annotations <a href="https://github.com/xmolecules/jmolecules" target="_blank" rel="noopener noreferrer">jMolecules<Icon name="ri/external-link-line" class="inline size-3.5 ml-0.5" aria-hidden="true" /></a> lèvent l'ambiguïté là où la structure manque</li>
			</ul>
		</SectionCopy>

		<div class="mt-10 max-w-4xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6">
			<div class="p-6 bg-astro-dark-800/40 border border-astro-green/15 rounded-2xl">
				<h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
					<Icon name="ri/sparkling-2-line" class="size-5 text-astro-green" aria-hidden="true" />
					Domaine riche
				</h3>
				<p class="text-sm text-astro-gray-200 font-light mb-4">
					Le code porte sa propre sémantique. HexaGlue le classifie automatiquement.
				</p>
				<ul class="space-y-2 text-sm text-astro-gray-200 font-light list-disc list-inside">
					<li>Records pour les value objects et identifiants</li>
					<li>Champs d'identité typés (<code>OrderId</code>)</li>
					<li>Logique métier dans les agrégats, fabriques statiques</li>
					<li>Interfaces dans <code>ports/in/</code> et <code>ports/out/</code></li>
				</ul>
			</div>
			<div class="p-6 bg-astro-dark-800/40 border border-amber-400/15 rounded-2xl">
				<h3 class="text-lg font-semibold text-white mb-4 flex items-center gap-2">
					<Icon name="ri/error-warning-line" class="size-5 text-amber-400" aria-hidden="true" />
					Domaine anémique
				</h3>
				<p class="text-sm text-astro-gray-200 font-light mb-4">
					Le code manque de signaux structurels. Les annotations jMolecules expriment l'intention architecturale.
				</p>
				<ul class="space-y-2 text-sm text-astro-gray-200 font-light list-disc list-inside">
					<li>Types primitifs (<code>Long</code>, <code>String</code>) au lieu de value objects</li>
					<li>Getters/setters sans logique métier</li>
					<li>Classes qui se ressemblent toutes structurellement</li>
					<li><code>@AggregateRoot</code>, <code>@Entity</code>, <code>@ValueObject</code> pour lever l'ambiguïté</li>
				</ul>
			</div>
		</div>

		<div class="table-panel mt-10">
			<div class="table-panel-content max-w-4xl mx-auto">
				<h3 class="text-lg font-semibold text-white mb-4">Annotations et interfaces jMolecules supportées</h3>
				<div class="overflow-x-auto">
				<table class="w-full text-sm text-left">
				<thead>
					<tr class="border-b border-astro-dark-100/20">
						<th class="py-3 pr-4 text-astro-gray-300 font-medium">Couche</th>
						<th class="py-3 pr-4 text-astro-gray-300 font-medium">Annotation</th>
						<th class="py-3 pr-4 text-astro-gray-300 font-medium">Interface</th>
						<th class="py-3 text-astro-gray-300 font-medium">Rôle attribué</th>
					</tr>
				</thead>
				<tbody class="text-astro-gray-200">
					<tr class="border-b border-astro-dark-100/10">
						<td class="py-3 pr-4 font-medium text-white whitespace-nowrap">Domaine</td>
						<td class="py-3 pr-4 whitespace-nowrap"><code>@AggregateRoot</code></td>
						<td class="py-3 pr-4 whitespace-nowrap"><code>AggregateRoot</code></td>
						<td class="py-3 whitespace-nowrap">Aggregate Root</td>
					</tr>
					<tr class="border-b border-astro-dark-100/10">
						<td class="py-3 pr-4 font-medium text-white whitespace-nowrap">Domaine</td>
						<td class="py-3 pr-4 whitespace-nowrap"><code>@Entity</code></td>
						<td class="py-3 pr-4 whitespace-nowrap"><code>Entity</code></td>
						<td class="py-3 whitespace-nowrap">Entity</td>
					</tr>
					<tr class="border-b border-astro-dark-100/10">
						<td class="py-3 pr-4 font-medium text-white whitespace-nowrap">Domaine</td>
						<td class="py-3 pr-4 whitespace-nowrap"><code>@ValueObject</code></td>
						<td class="py-3 pr-4 whitespace-nowrap"><code>ValueObject</code></td>
						<td class="py-3 whitespace-nowrap">Value Object</td>
					</tr>
					<tr class="border-b border-astro-dark-100/10">
						<td class="py-3 pr-4 font-medium text-white whitespace-nowrap">Domaine</td>
						<td class="py-3 pr-4 whitespace-nowrap"><code>@Identity</code></td>
						<td class="py-3 pr-4 whitespace-nowrap"><code>Identifier</code></td>
						<td class="py-3 whitespace-nowrap">Identifier</td>
					</tr>
					<tr class="border-b border-astro-dark-100/10">
						<td class="py-3 pr-4 font-medium text-white whitespace-nowrap">Événements</td>
						<td class="py-3 pr-4 whitespace-nowrap"><code>@DomainEvent</code></td>
						<td class="py-3 pr-4 whitespace-nowrap">—</td>
						<td class="py-3 whitespace-nowrap">Domain Event</td>
					</tr>
					<tr class="border-b border-astro-dark-100/10">
						<td class="py-3 pr-4 font-medium text-white whitespace-nowrap">Événements</td>
						<td class="py-3 pr-4 whitespace-nowrap"><code>@Externalized</code></td>
						<td class="py-3 pr-4 whitespace-nowrap">—</td>
						<td class="py-3 whitespace-nowrap">Externalized Event</td>
					</tr>
					<tr class="border-b border-astro-dark-100/10">
						<td class="py-3 pr-4 font-medium text-white whitespace-nowrap">Ports</td>
						<td class="py-3 pr-4 whitespace-nowrap"><code>@PrimaryPort</code></td>
						<td class="py-3 pr-4 whitespace-nowrap"><code>PrimaryPort</code></td>
						<td class="py-3 whitespace-nowrap">Driving Port</td>
					</tr>
					<tr class="border-b border-astro-dark-100/10">
						<td class="py-3 pr-4 font-medium text-white whitespace-nowrap">Ports</td>
						<td class="py-3 pr-4 whitespace-nowrap"><code>@SecondaryPort</code></td>
						<td class="py-3 pr-4 whitespace-nowrap"><code>SecondaryPort</code></td>
						<td class="py-3 whitespace-nowrap">Driven Port</td>
					</tr>
					<tr>
						<td class="py-3 pr-4 font-medium text-white whitespace-nowrap">Ports</td>
						<td class="py-3 pr-4 whitespace-nowrap"><code>@Repository</code></td>
						<td class="py-3 pr-4 whitespace-nowrap">—</td>
						<td class="py-3 whitespace-nowrap">Repository (Driven)</td>
					</tr>
				</tbody>
			</table>
				</div>
			</div>
		</div>

		<div class="max-w-4xl mx-auto">
			<Insight variant="green">
				<p><strong>jMolecules</strong> est une bibliothèque d'annotations purement sémantiques pour le DDD et l'architecture hexagonale.
				Contrairement à <code>@Entity</code> (JPA) ou <code>@Service</code> (Spring), les annotations jMolecules n'introduisent aucun couplage technique : pas de comportement au runtime, pas de dépendance vers un framework d'infrastructure.
				Elles expriment une <strong>intention architecturale</strong>, pas une contrainte technique.</p>
				<br>
				<p>C'est pourquoi les utiliser dans le domaine <strong>ne viole pas les principes de l'architecture hexagonale</strong> : le domaine reste pur, indépendant de l'infrastructure, et les annotations ne sont consommées qu'au compile-time par des outils comme HexaGlue.</p>
				<br>
				<p>Vous pouvez les adopter progressivement : annotez seulement les classes ambiguës, HexaGlue classifie le reste automatiquement.</p>
			</Insight>
		</div>
	</section>

	<!-- Section 3 : Quand la classification échoue -->
	<section class="py-16 md:py-20 relative w-full max-w-screen-xl mx-auto px-4 sm:px-8">
		<SectionCopy
			label="Types non classifiés"
			title="Les zones grises de votre architecture"
		>
			Toutes les classes ne correspondent pas à un rôle DDD ou hexagonal. HexaGlue les classe dans des catégories qui vous aident à comprendre pourquoi.
		</SectionCopy>

		<div class="table-panel mt-10">
			<div class="table-panel-content max-w-4xl mx-auto overflow-x-auto">
				<table class="w-full text-sm text-left">
					<thead>
						<tr class="border-b border-astro-dark-100/20">
							<th class="py-3 pr-4 text-astro-gray-300 font-medium">Catégorie</th>
							<th class="py-3 pr-4 text-astro-gray-300 font-medium">Signification</th>
							<th class="py-3 text-astro-gray-300 font-medium">Exemple typique</th>
						</tr>
					</thead>
					<tbody class="text-astro-gray-200">
						<tr class="border-b border-astro-dark-100/10">
							<td class="py-3 pr-4 whitespace-nowrap"><code class="accent">AMBIGUOUS</code></td>
							<td class="py-3 pr-4">Critères évalués, pas de match clair</td>
							<td class="py-3">Classe avec des traits de plusieurs rôles</td>
						</tr>
						<tr class="border-b border-astro-dark-100/10">
							<td class="py-3 pr-4 whitespace-nowrap"><code class="accent">CONFLICTING</code></td>
							<td class="py-3 pr-4">Plusieurs règles en conflit</td>
							<td class="py-3">Entité qui ressemble aussi à un value object</td>
						</tr>
						<tr class="border-b border-astro-dark-100/10">
							<td class="py-3 pr-4 whitespace-nowrap"><code class="accent">UTILITY</code></td>
							<td class="py-3 pr-4">Classe utilitaire détectée par suffixe</td>
							<td class="py-3"><code>StringUtils</code>, <code>DateHelper</code></td>
						</tr>
						<tr class="border-b border-astro-dark-100/10">
							<td class="py-3 pr-4 whitespace-nowrap"><code class="accent">TECHNICAL</code></td>
							<td class="py-3 pr-4">Classe d'infrastructure annotée</td>
							<td class="py-3"><code>@Configuration</code>, <code>@Component</code></td>
						</tr>
						<tr>
							<td class="py-3 pr-4 whitespace-nowrap"><code class="accent">OUT_OF_SCOPE</code></td>
							<td class="py-3 pr-4">Package de test ou mock</td>
							<td class="py-3"><code>com.acme.shop.test.*</code></td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<div class="max-w-4xl mx-auto">
			<Insight variant="amber">
				<p>Les classes non classifiées ne sont pas un problème : elles signalent les zones grises de votre architecture. L'audit les comptabilise et propose des pistes de remédiation. Un projet legacy typique démarre avec 30 à 50% de classes non classifiées : c'est normal.</p>
			</Insight>
		</div>
	</section>

	<!-- CTA Final -->
	<section class="py-16 md:py-24 mb-12 relative">
		<div class="w-full max-w-screen-xl mx-auto px-4 sm:px-8 text-center space-y-6">
			<h2 class="font-heading heading-bold text-3xl md:text-4xl lg:text-5xl text-white">
				<span class="text-astro-gray-300">Voyez la classification en action.</span><br/>
				50 classes classifiées en un build.
			</h2>

			<p class="text-xl text-astro-gray-200 font-light max-w-2xl mx-auto">
				Découvrez comment HexaGlue classifie un projet legacy de 50 classes, étape par étape.
			</p>

			<div class="pt-4 flex flex-col sm:flex-row items-center justify-center gap-4">
				<Link href="/case-studies/ecommerce-migration/step-1-discovery/" class="primary">
					Voir la classification en action
				</Link>
				<Link href="/docs/getting-started/" class="secondary">
					<Icon name="ri/rocket-line" class="size-5" aria-hidden="true" />
					<span>Démarrer en 5 minutes</span>
				</Link>
			</div>
		</div>
		<div
			class="absolute inset-x-0 bottom-0 h-[50vw] translate-y-[60%] bg-blue-green-gradient opacity-50 mask-radial-gradient pointer-events-none"
		></div>
	</section>
</MainLayout>

<style>
	code {
		@apply px-1.5 py-0.5 bg-astro-dark-600 rounded text-xs text-astro-gray-100;
		font-family: 'JetBrains Mono', ui-monospace, monospace;
	}
	code.accent {
		@apply bg-transparent px-0 py-0 text-astro-green;
	}
	.table-panel {
		position: relative;
		left: 50%;
		margin-left: -50vw;
		width: 100vw;
		padding: 2.5rem 1rem;
		border-top: 1px solid rgba(56, 189, 126, 0.07);
		border-bottom: 1px solid rgba(56, 189, 126, 0.07);
		background:
			radial-gradient(circle at 1px 1px, rgba(56, 189, 126, 0.12) 1px, transparent 0) 0 0 / 24px 24px,
			linear-gradient(180deg, rgba(56, 189, 126, 0.04) 0%, rgba(56, 189, 126, 0.02) 50%, rgba(56, 189, 126, 0.04) 100%);
	}
	.table-panel-content {
		background-color: #0e0d12;
		border: 1px solid rgba(56, 189, 126, 0.1);
		border-radius: 0.75rem;
		padding: 1.5rem;
		box-shadow:
			0 0 20px rgba(56, 189, 126, 0.12),
			0 0 50px rgba(56, 189, 126, 0.07),
			0 0 80px rgba(56, 189, 126, 0.04),
			0 1px 2px rgba(0, 0, 0, 0.4),
			0 4px 16px rgba(0, 0, 0, 0.3);
	}
</style>
