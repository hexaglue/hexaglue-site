---
import { Icon } from 'astro-icon/components';
import siteInfo from '~/data/site-info.js';
import SocialLinks from './SocialLinks.astro';

const nav: Nav = [
	{
		label: 'Ressources',
		theme: 'green',
		items: [
			{ href: '/getting-started/', label: 'Documentation', icon: 'file-alt', prefetch: true },
			{ href: 'https://github.com/hexaglue/hexaglue', label: 'GitHub', icon: 'logos/github' },
		],
	},
	{
		label: 'Exemples',
		theme: 'orange',
		items: [
			{ href: '/case-studies/', label: 'Études de cas', icon: 'file-alt', prefetch: true },
			{ href: 'https://github.com/hexaglue/hexaglue/tree/main/examples', label: 'Exemples de code', icon: 'ri/code-box-line' },
		],
	},
	{
		label: 'Entreprise',
		theme: 'purple',
		items: [
			{ href: '/services/', label: 'Services', icon: 'ri/building-4-line', prefetch: true },
			{ href: '/contact/', label: 'Contact', icon: 'email', prefetch: true },
		],
	},
	{
		label: 'Communauté',
		theme: 'blue',
		items: [
			{ href: 'https://github.com/hexaglue/hexaglue/discussions', label: 'GitHub Discussions', icon: 'logos/github' },
			{ href: 'https://github.com/hexaglue/hexaglue/blob/main/CONTRIBUTING.md', label: 'Contribuer', icon: 'ri/code-s-slash-line' },
		],
	},
];

interface Link {
	href: string;
	label: string;
	prefetch?: true;
}
interface GroupLink extends Link {
	icon: string;
	badge?: string;
}
interface Group {
	label: string;
	theme?: 'blue' | 'orange' | 'green' | 'purple';
	items: GroupLink[];
}
type Nav = Array<Link | Group>;

const themeAccents: Record<string, { border: string; bg: string }> = {
	blue: {
		border: 'rgba(50, 69, 255, 0.40)',
		bg: 'rgba(50, 69, 255, 0.06)',
	},
	orange: {
		border: 'rgba(255, 125, 84, 0.40)',
		bg: 'rgba(255, 125, 84, 0.06)',
	},
	green: {
		border: 'rgba(74, 242, 200, 0.35)',
		bg: 'rgba(74, 242, 200, 0.05)',
	},
	purple: {
		border: 'rgba(188, 82, 238, 0.40)',
		bg: 'rgba(188, 82, 238, 0.06)',
	},
};
---

<nav
	aria-label="Primary"
	class="text-xl flex flex-col divide-y divide-astro-gray-500 pb-12 text-left [&>*]:p-6"
>
	{
		nav.map((item) =>
			'href' in item ? (
				// Top-level link
				<a
					class="link"
					href={item.href}
					data-astro-prefetch={item.prefetch ? '' : undefined}
					set:text={item.label}
				/>
			) : (
				// Drop-down group
				<details class="group">
					<summary class="accordion link flex cursor-pointer list-none items-center justify-between">
						{item.label}
						<Icon
							name="chevron"
							aria-hidden="true"
							class="inline-block size-3 rotate-0 transition-transform group-open:-rotate-180 duration-300"
						/>
					</summary>
					<div
						class="mt-4 flex flex-col gap-4 text-xl font-light"
						style={item.theme && themeAccents[item.theme]
							? `border-left: 2px solid ${themeAccents[item.theme].border}; background: linear-gradient(90deg, ${themeAccents[item.theme].bg} 0%, transparent 100%); padding-left: 1rem; border-radius: 0.5rem;`
							: undefined}
					>
						{item.items.map((link) => {
							const isExternal = link.href.startsWith('http://') || link.href.startsWith('https://');
							return (
								<a
									href={link.href}
									target={isExternal ? '_blank' : undefined}
									rel={isExternal ? 'noopener noreferrer' : undefined}
									data-astro-prefetch={link.prefetch ? '' : undefined}
									class="link flex items-center gap-4"
								>
									<Icon name={link.icon} size="24" aria-hidden="true" /> {link.label}{' '}
									{link.badge && (
										<span class="text-sm leading-none font-mono py-1 px-1.5 rounded bg-astro-blue/40 border border-astro-blue">
											{link.badge}
										</span>
									)}
								</a>
							);
						})}
					</div>
				</details>
			),
		)
	}

	<div class="flex flex-wrap justify-between gap-12 gap-y-6">
		<SocialLinks links={siteInfo.socialLinks} />
		<a href="/getting-started/" class="button button-primary flex-grow sm:max-w-sm">
			Lire la documentation
		</a>
	</div>
</nav>
