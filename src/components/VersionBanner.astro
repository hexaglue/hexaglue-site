---
import { Icon } from 'astro-icon/components';

interface Props {
	variant: 'past' | 'upcoming';
	version: string;
	latestUrl: string;
}

const { variant, version, latestUrl } = Astro.props;

const config = {
	past: {
		icon: 'ri:time-line',
		headline: 'Version obsolète',
		subtext: 'Cette documentation ne correspond plus à la version courante du plugin.',
		cta: 'Version stable',
	},
	upcoming: {
		icon: 'ri:error-warning-line',
		headline: 'Version non publiée',
		subtext: 'Cette documentation décrit une version en cours de développement. Le contenu peut changer.',
		cta: 'Version stable',
	},
};

const c = config[variant];
const isUpcoming = variant === 'upcoming';
---

<div class="relative z-[15] w-full max-w-screen-xl mx-auto px-4 sm:px-8 pt-20">
	<a
		href={latestUrl}
		class:list={[
			'version-banner group flex flex-wrap items-center gap-x-4 gap-y-2 rounded-xl px-5 py-3',
			'transition-all duration-300',
			isUpcoming ? 'is-upcoming' : 'is-past',
		]}
		role="status"
	>
		<div class="flex items-center gap-3">
			{isUpcoming && <span class="pulse-dot" aria-hidden="true" />}
			<Icon name={c.icon} class="version-icon size-6 shrink-0" aria-hidden="true" />
		</div>

		<div class="flex flex-col gap-y-0.5 flex-1 min-w-0">
			<span class="version-headline">
				{c.headline}
				<span class="version-tag">v{version}</span>
			</span>
			<span class="text-sm font-light version-subtext">{c.subtext}</span>
		</div>

		<span class="version-cta ml-auto inline-flex items-center gap-1.5 rounded-full px-4 py-1.5 text-xs font-semibold uppercase tracking-wide text-white transition-shadow duration-300">
			{c.cta}
			<Icon name="ri:arrow-right-line" class="size-3.5" aria-hidden="true" />
		</span>
	</a>
</div>

<style>
	.version-banner {
		border: 1px solid;
	}

	/* Upcoming: rouge rosé (rose-600 / red-400) */
	.is-upcoming {
		border-color: rgba(225, 29, 72, 0.25);
		background: linear-gradient(135deg, rgba(225, 29, 72, 0.12) 0%, rgba(244, 63, 94, 0.05) 100%);
		box-shadow: inset 0 1px 0 rgba(225, 29, 72, 0.12);
	}
	.is-upcoming:hover {
		border-color: rgba(225, 29, 72, 0.4);
	}
	.is-upcoming .version-icon {
		color: #fb7185;
	}
	.is-upcoming .version-headline {
		color: rgba(255, 255, 255, 0.9);
	}
	.is-upcoming .version-subtext {
		color: #fda4af;
	}
	.is-upcoming .version-tag {
		background: rgba(225, 29, 72, 0.25);
		border-color: rgba(225, 29, 72, 0.45);
		color: #fda4af;
	}
	.is-upcoming .version-cta {
		background: linear-gradient(135deg, #e11d48, #f43f5e);
	}
	.is-upcoming:hover .version-cta {
		box-shadow: 0 0 16px rgba(225, 29, 72, 0.35);
	}

	/* Pulse dot */
	.pulse-dot {
		position: relative;
		width: 8px;
		height: 8px;
		border-radius: 50%;
		background-color: #fb7185;
		box-shadow: 0 0 6px rgba(225, 29, 72, 0.6);
	}
	.pulse-dot::before {
		content: '';
		position: absolute;
		inset: -3px;
		border-radius: 50%;
		border: 2px solid rgba(225, 29, 72, 0.4);
		animation: pulse-ring 2s ease-out infinite;
	}
	@keyframes pulse-ring {
		0% { transform: scale(1); opacity: 1; }
		100% { transform: scale(2); opacity: 0; }
	}

	/* Past: ambre / doré */
	.is-past {
		border-color: rgba(245, 158, 11, 0.25);
		background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.03) 100%);
		box-shadow: inset 0 1px 0 rgba(245, 158, 11, 0.1);
	}
	.is-past:hover {
		border-color: rgba(245, 158, 11, 0.4);
	}
	.is-past .version-icon {
		color: #fbbf24;
	}
	.is-past .version-headline {
		color: rgba(255, 255, 255, 0.9);
	}
	.is-past .version-subtext {
		color: #fcd34d;
	}
	.is-past .version-tag {
		background: rgba(245, 158, 11, 0.2);
		border-color: rgba(245, 158, 11, 0.4);
		color: #fcd34d;
	}
	.is-past .version-cta {
		background: linear-gradient(135deg, #d97706, #f59e0b);
	}
	.is-past:hover .version-cta {
		box-shadow: 0 0 16px rgba(245, 158, 11, 0.35);
	}

	/* Commun */
	.version-headline {
		display: flex;
		flex-wrap: wrap;
		align-items: center;
		gap: 0.5rem;
		font-size: 1rem;
		font-weight: 500;
	}
	.version-tag {
		display: inline-flex;
		align-items: center;
		border-radius: 0.375rem;
		border: 1px solid;
		padding: 0.0625rem 0.5rem;
		font-size: 0.75rem;
		font-weight: 700;
		font-variant-numeric: tabular-nums;
	}
</style>
